<html>
  <head>
    <meta charset="utf-8" />
    <title>文化祭から始まるVR生活</title>
    <meta name="description" content="文化祭から始まるVR生活" />

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
    <script src="/build.js"></script>
    <script>
      window.NAF ||
        document.write(
          '<script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js">\x3C/script>',
        );
    </script>

    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <!-- オブジェクトを掴んで動かす -->
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>
    <!-- 瞬間移動 -->
    <script src="./js/aframe/blink-teleportion.js"></script>
    <!-- progressive controls -->
    <script src="./js/aframe/progressive-controls.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    <!-- vueスクリプト  -->
    <script src="https://unpkg.com/vue/dist/vue.min.js"></script>
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- vuejsのメイン -->
    <script src="./js/vue.js"></script>
    <!-- Vueのコンポーネント化したいのはこちらに -->
    <script src="./js/components/sample-component.js"></script>
  </head>
  <body>
    <div id="vue-root">
      <!-- audio: trueを付与すると音声も取り入れられるけど、動作が重くなる問題があるので、コメントアウト -->
      <a-scene
        networked-scene="
          room: dev;
          debug: true;
          adapter: webrtc;
        "
      >
        <a-assets>
          <img
            id="grid"
            src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png"
            crossorigin="anonymous"
          />
          <img id="sky" src="./assets/img/sky.jpg" crossorigin="anonymous" />

          <!-- 作品の読み込み -->
          <img
            v-for="(exhibit, i) in exhibits"
            :id="`asset-exhibit-thumbnail-${exhibit.id}`"
            :src="exhibit.thumbnail"
            crossorigin="anonymous"
          />

          <!-- アバター -->
          <template id="avatar-template">
            <a-entity class="avatar">
              <a-sphere
                class="head"
                color="#ffffff"
                scale="0.45 0.5 0.4"
              ></a-sphere>
              <a-entity class="face" position="0 0.05 0">
                <a-sphere
                  class="eye"
                  color="#efefef"
                  position="0.16 0.1 -0.35"
                  scale="0.12 0.12 0.12"
                >
                  <a-sphere
                    class="pupil"
                    color="#000"
                    position="0 0 -1"
                    scale="0.2 0.2 0.2"
                  ></a-sphere>
                </a-sphere>
                <a-sphere
                  class="eye"
                  color="#efefef"
                  position="-0.16 0.1 -0.35"
                  scale="0.12 0.12 0.12"
                >
                  <a-sphere
                    class="pupil"
                    color="#000"
                    position="0 0 -1"
                    scale="0.2 0.2 0.2"
                  ></a-sphere>
                </a-sphere>
              </a-entity>
            </a-entity>
          </template>
          <img id="footsteps" src="./assets/img/footsteps.png" />
          <img id="black" src="./assets/img/black.png" />
        </a-assets>

        <!-- 赤ボックス | クリックするとテレポートされる -->
        <a-box
          color="#AA0000"
          position="-3 0.5 4"
          class="clickable"
          blink-teleportation="pos: -2 1.6 4"
        >
        </a-box>

        <!-- 緑ボックス | クリックしてテレポート | クリックされたあと、消えるよ -->
        <a-box
          color="#00AA00"
          position="3 0.5 4"
          class="clickable"
          blink-teleportation="pos: 2 1.6 4; hide: true"
        >
        </a-box>

        <!-- 黄色ボックス -->
        <a-box color="#FFAA00" position="-3 0.5 -4"> </a-box>
        <!-- クリックしてテレポート | クリックされたあと、消えるよ -->
        <a-image
          src="#footsteps"
          position="-3 2.5 -4"
          look-at="#player"
          class="clickable"
          blink-teleportation="pos: -2 1.6 -4; hide: true"
        >
        </a-image>

        <!-- 青ボックス -->
        <a-box color="#0077FF" position="3 0.5 -4"> </a-box>
        <!-- クリックしてテレポート -->
        <a-image
          src="#footsteps"
          position="3 2.5 -4"
          look-at="#player"
          class="clickable"
          blink-teleportation="pos: 2 1.6 -4"
        >
        </a-image>

        <!-- 床 -->
        <a-entity
          position="0 0 0"
          geometry="primitive: plane; width: 10000; height: 10000;"
          rotation="-90 0 0"
          material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"
        ></a-entity>

        <!-- 何らかの視覚効果のようだ -->
        <a-entity
          light="color: #ccccff; intensity: 1; type: ambient;"
          visible=""
        ></a-entity>
        <a-entity
          light="color: #ffaaff; intensity: 1.5"
          position="5 5 5"
        ></a-entity>

        <!-- 空なのだ -->
        <a-sky src="#sky" rotation="0 -90 0"></a-sky>
        <!-- 粒子効果なのだ -->
        <a-entity id="particles" particle-system="preset: snow"></a-entity>

        <!-- API通信の結果を反映した画像表示サンプル -->
        <a-image
          v-for="(exhibit, i) in exhibits"
          :key="`exhibit-thumbnail-${exhibit.id}`"
          :src="`#asset-exhibit-thumbnail-${exhibit.id}`"
          scale="2 2 1"
          :position="`0 1 ${exhibit.id}`"
        >
        </a-image>

        <!-- カメラ（なんか、a-sceneの最後の方に置いた方がいいらしい） -->
        <a-camera
          id="player"
          position="0 1.6 0"
          networked="template:#avatar-template;attachTemplateToLocal:false;"
          spawn-in-circle="radius:3"
          wasd-controls
          look-controls
        >
          <!-- SELECTIVE INTERSECTIONS -->
          <a-cursor raycaster="objects: .clickable"></a-cursor>
          <a-sphere class="head" visible="false" random-color></a-sphere>
        </a-camera>
      </a-scene>
    </div>

    <script>
      // eslint-disable-next-line no-undef
      var isMobile = AFRAME.utils.device.isMobile();

      if (isMobile) {
        var particles = document.getElementById('particles');
        particles.parentNode.removeChild(particles);
      }
    </script>

    <script>
      // eslint-disable-next-line no-undef
      NAF.schemas.add({
        template: '#avatar-template',
        components: [
          'position',
          'rotation',
          {
            selector: '.head',
            component: 'material',
            property: 'color',
          },
        ],
      });

      // eslint-disable-next-line no-unused-vars
      function onConnect() {
        console.log('onConnect', new Date());
      }
    </script>
  </body>
</html>
