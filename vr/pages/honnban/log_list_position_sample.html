<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒ­ã‚°ã®ãƒªã‚¹ãƒˆã‚’å‡ºã™ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…</title>
  </head>
  <body>
    <button id="position_iine_button">positionæŒ‡å®šç”¨ã„ã„ã­ãƒœã‚¿ãƒ³</button>

    <!-- ã“ã“ã«ãƒ­ã‚°ãŒæµã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ -->
    <div id="position_log_list" style="position: relative"></div>

    <script>
      // cssè¦ç´ ã‹ã‚‰topã®å€¤ã‚’å–å¾—ã™ã‚‹å°‚ç”¨é–¢æ•°
      const getTopValue = (element) => {
        const cssTexts = element.style.cssText.split(';');
        console.log('csstexts', cssTexts);
        const topText = cssTexts.find((text) => {
          console.log(text);
          return text.includes('top');
        });

        return topText ? topText.replace(/\D/g, '') : null;
      };

      // elementã‚’æŒ‡å®šç§’å¾Œã«å‰Šé™¤ã—ã¤ã¤ã€æŒ‡å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å­è¦ç´ ã®å…¨ã¦ã‚’ä¸Šã«ã‚¹ãƒ©ã‚¤ãƒ‰ã™ã‚‹é–¢æ•°
      // ã¡ã‚‡ã£ã¨ã‚„ã‚„ã“ã—ã„ã‹ã‚‚ğŸ™
      const removePositionElementTimer = (function () {
        const timers = []; // variable persisted here

        return function (element, timerMillSec = 4000) {
          // ãƒ©ãƒ³ãƒ€ãƒ IDã‚’ç”Ÿæˆ
          const uniqueId = Math.floor(Math.random() * 1000);
          // timerã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ï¼ˆã‚¿ã‚¤ãƒãƒ¼ã‚’idã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
          window.clearTimeout(timers[uniqueId]);

          timers[uniqueId] = window.setTimeout(function () {
            // è¦ç´ ã®å‰Šé™¤
            element.remove();
            // å­è¦ç´ ã®å…¨ã¦ã‚’ä¸Šã«ã‚¹ãƒ©ã‚¤ãƒ‰ã™ã‚‹
            const positionLogListEl = document.getElementById(
              'position_log_list',
            );
            const logElChildren = positionLogListEl.children;
            for (let i = 0; i < logElChildren.length; i++) {
              const topValue = getTopValue(logElChildren[i]);
              logElChildren[i].setAttribute(
                'style',
                `position: absolute; top: ${+topValue - 30}px`,
              );
            }
          }, timerMillSec);
        };
      })();

      // ãƒã‚¸ã‚·ãƒ§ãƒ³æŒ‡å®šç”¨ã®ã„ã„ã­ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹
      const positionIineButtonEl = document.getElementById(
        'position_iine_button',
      );
      positionIineButtonEl.addEventListener('click', () => {
        // ãƒ­ã‚°ã®ãƒªã‚¹ãƒˆã®è¦ç´ 
        const logListEl = document.getElementById('position_log_list');
        // æ–°è¦ã«è¿½åŠ ã™ã‚‹è¦ç´ 
        const newLogEl = document.createElement('div');
        const randomNum = Math.floor(Math.random() * 100);
        newLogEl.innerHTML = `ã»ã’ã»ã’ ãã®${randomNum}ã•ã‚“ãŒã„ã„ã­ã—ã¾ã—ãŸ`;

        // æœ€å¾Œã®å°è¦ç´ ãŒã‚ã‚Œã°ã€ãã‚Œã‹ã‚‰topã®å€¤ã‚’å–å¾—ã—ã¦ã€ãã‚Œã«20pxåŠ ç®—ã™ã‚‹
        // ãªã‘ã‚Œã°0pxã¨ã™ã‚‹
        const lastLogEl = logListEl.lastElementChild;
        let lastTopValue = 0;
        if (lastLogEl) {
          lastTopValue = getTopValue(lastLogEl);
        }
        newLogEl.setAttribute(
          'style',
          `position: absolute; top: ${+lastTopValue + 30}px`,
        );

        // è¦ç´ ã‚’è¿½åŠ 
        logListEl.appendChild(newLogEl);
        // ãã®æ–°è¦ç´ ã¯æ•°ç§’å¾Œã«å‰Šé™¤ã™ã‚‹
        removePositionElementTimer(newLogEl);
      });
    </script>
  </body>
</html>
